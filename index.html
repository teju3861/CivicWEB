<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Civic Issues - Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Reset + Base */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
    body { background: #f9fafb; color: #333; line-height: 1.6; }

    /* Header + Footer */
    header, footer {
      background: #2563eb;
      color: white;
      text-align: center;
      padding: 1rem 2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,.15);
    }
    header h1 { margin-bottom: 0.3rem; font-size: 1.8rem; }
    header p { margin: 0; font-size: 1rem; color: #e0e7ff; }
    footer p { font-size: 0.9rem; }

    /* Layout */
    main {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 1.5rem;
      padding: 1.5rem;
      max-width: 1200px;
      margin: auto;
    }
    section {
      background: #fff;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.08);
    }
    h2 { margin-bottom: 1rem; color: #2563eb; }

    /* Form */
    input, textarea, select, button {
      width: 100%;
      margin-bottom: .8rem;
      padding: .8rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: border 0.3s, box-shadow 0.3s;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border: 1px solid #2563eb;
      box-shadow: 0 0 6px rgba(37, 99, 235, 0.3);
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }
    button:hover {
      background: #1e40af;
      transform: translateY(-2px);
    }

    /* Issues */
    .issue {
      display: flex;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid #eee;
      align-items: flex-start;
    }
    .issue img {
      width: 100px;
      height: 70px;
      object-fit: cover;
      border-radius: 6px;
      background: #ddd;
      flex-shrink: 0;
    }
    .issue h4 { margin: 0 0 .4rem; font-size: 1.1rem; color: #111; }
    .issue p { margin: 0 0 .4rem; font-size: 0.95rem; }
    .status {
      font-size: .8rem;
      padding: .25rem .6rem;
      border-radius: 12px;
      background: #e0e7ff;
      color: #2563eb;
      font-weight: 500;
    }
    .actions { margin-top: .5rem; }
    .actions button {
      margin-right: .5rem;
      width: auto;
      padding: .5rem .9rem;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    .actions button:nth-child(1) { background: #f59e0b; } /* Advance */
    .actions button:nth-child(1):hover { background: #d97706; }
    .actions button:nth-child(2) { background: #10b981; } /* Map */
    .actions button:nth-child(2):hover { background: #059669; }
    .actions button:nth-child(3) { background: #dc3545; } /* Delete */
    .actions button:nth-child(3):hover { background: #b91c1c; }

    /* Map */
    iframe {
      width: 100%;
      height: 250px;
      border: none;
      border-radius: 10px;
      margin-top: 1rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      main { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Civic Issues — Web</h1>
    <p>Report local problems quickly</p>
  </header>

  <main>
    <!-- Form -->
    <section>
      <h2>Report an Issue</h2>
      <input id="title" placeholder="Title">
      <textarea id="description" placeholder="Describe the issue"></textarea>
      <select id="category">
        <option>Pothole</option>
        <option>Streetlight</option>
        <option>Sanitation</option>
        <option>Water</option>
        <option>Traffic</option>
        <option>Other</option>
      </select>
      <input type="file" id="image">
      <button onclick="addIssue()">Report</button>
      <p id="gpsInfo">Detecting GPS...</p>
      <img id="preview" style="display:none; width:100%; margin-top:5px; border-radius:5px;">
    </section>

    <!-- Issue List -->
    <section>
      <h2>Reported Issues</h2>
      <select id="filter" onchange="renderIssues()">
        <option value="all">All</option>
        <option>Reported</option>
        <option>Acknowledged</option>
        <option>In Progress</option>
        <option>Resolved</option>
      </select>
      <div id="issues"></div>

      <h3 style="margin-top:1.5rem; color:#2563eb;">Map Preview</h3>
      <iframe id="mapFrame"></iframe>
    </section>
  </main>

  <footer>
    <p>Prototype — data is saved in localStorage only.</p>
  </footer>

  <script>
    let gps = null;
    let imageData = null;
    let issues = JSON.parse(localStorage.getItem("ci_issues") || "[]");

    navigator.geolocation.getCurrentPosition(pos => {
      gps = { lat: pos.coords.latitude, lng: pos.coords.longitude };
      document.getElementById("gpsInfo").innerText = 
        `GPS: ${gps.lat.toFixed(5)}, ${gps.lng.toFixed(5)}`;
      updateMap();
    });

    document.getElementById("image").addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        imageData = url;
        const prev = document.getElementById("preview");
        prev.src = url; prev.style.display = "block";
      }
    });

    function addIssue() {
      const title = document.getElementById("title").value.trim();
      if (!title) return alert("Add a title");
      const desc = document.getElementById("description").value.trim();
      const cat = document.getElementById("category").value;
      const issue = {
        id: Date.now(),
        title, description: desc, category: cat,
        status: "Reported",
        gps, image: imageData,
        createdAt: new Date().toLocaleString()
      };
      issues.unshift(issue);
      localStorage.setItem("ci_issues", JSON.stringify(issues));
      document.getElementById("title").value = "";
      document.getElementById("description").value = "";
      document.getElementById("image").value = "";
      document.getElementById("preview").style.display = "none";
      imageData = null;
      renderIssues();
    }

    function changeStatus(id) {
      issues = issues.map(it => {
        if (it.id === id) {
          if (it.status === "Reported") it.status = "Acknowledged";
          else if (it.status === "Acknowledged") it.status = "In Progress";
          else if (it.status === "In Progress") it.status = "Resolved";
        }
        return it;
      });
      localStorage.setItem("ci_issues", JSON.stringify(issues));
      renderIssues();
    }

    function deleteIssue(id) {
      if (!confirm("Delete this report?")) return;
      issues = issues.filter(it => it.id !== id);
      localStorage.setItem("ci_issues", JSON.stringify(issues));
      renderIssues();
    }

    function openMap(lat, lng) {
      window.open(`https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=18/${lat}/${lng}`);
    }

    function updateMap() {
      if (gps) {
        document.getElementById("mapFrame").src =
          `https://www.openstreetmap.org/export/embed.html?bbox=${gps.lng-0.02}%2C${gps.lat-0.02}%2C${gps.lng+0.02}%2C${gps.lat+0.02}&layer=mapnik&marker=${gps.lat}%2C${gps.lng}`;
      }
    }

    function renderIssues() {
      const filter = document.getElementById("filter").value;
      const wrap = document.getElementById("issues");
      wrap.innerHTML = "";
      const shown = issues.filter(it => filter === "all" ? true : it.status === filter);
      if (!shown.length) { wrap.innerHTML = "<p>No issues yet</p>"; return; }
      shown.forEach(it => {
        const div = document.createElement("div");
        div.className = "issue";
        div.innerHTML = `
          ${it.image ? `<img src=\"${it.image}\">` : `<div style='width:100px;height:70px;background:#eee;border-radius:5px'></div>`}
          <div style=\"flex:1\">
            <h4>${it.title}</h4>
            <p>${it.description}</p>
            <div><span class='status'>${it.status}</span> • ${it.category}</div>
            <div class='actions'>
              <button onclick=\"changeStatus(${it.id})\">Advance</button>
              <button onclick=\"${it.gps ? `openMap(${it.gps.lat},${it.gps.lng})` : `alert('No GPS')`}\">Map</button>
              <button onclick=\"deleteIssue(${it.id})\">Delete</button>
            </div>
          </div>
        `;
        wrap.appendChild(div);
      });
    }

    renderIssues();
  </script>
</body>
</html>
